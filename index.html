<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è–èª•è¨Šè™Ÿå°éŠæˆ²</title>
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;           /* ä¸è¦æ²å‹•æ¢ï¼Œå…¨è¢å¹•éŠæˆ² */
    }
    body {
      background: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #fff;
    }

    /* å¤–å±¤ï¼šç›´æ¥ä½”æ»¿æ•´å€‹è¦–çª—ï¼ˆå…¨è¢å¹•ï¼‰ */
    .wrapper {
      position: relative;
      width: 100vw;
      height: 100vh;
      max-width: none;
      margin: 0;
      overflow: hidden;
    }

    /* è–èª•åœ–ç‰‡é‹ªæ»¿å…¨è¢å¹• */
    .main-image {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;      /* ç­‰æ¯”ä¾‹è£åˆ‡é‹ªæ»¿ç•«é¢ */
    }

    /* åŠåœ“æŒ‡é‡ç–Šåœ¨ç•«é¢ä¸‹æ–¹ */
    #overlay {
      position: absolute;
      left: 50%;
      bottom: 8%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 600px;
      display: flex;
      justify-content: center;
      pointer-events: none;   /* é»æ“Šäº¤çµ¦ window */
    }

    #gameCanvas {
      width: 100%;
      max-width: 600px;
      height: auto;
      display: block;
    }

    /* ä¸‰ç¨®å…¨è¢å¹•é®ç½©ï¼šä¸­çå½±ç‰‡ / æŠ½çå½±ç‰‡ / è¨Šæ¯æ¡† */
    #winOverlay,
    #prizeOverlay,
    #messageOverlay,
    #resultOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;              /* é è¨­éš±è— */
      justify-content: center;
      align-items: center;
      z-index: 900;
    }

    #winOverlay video,
    #prizeOverlay video {
      width: 95vw;
      max-width: 560px;
      border-radius: 16px;
    }

    /* è¨Šæ¯æ¡†æ¯”å½±ç‰‡å†é«˜ä¸€å±¤ï¼Œé¿å…è¢«è“‹ä½ */
    #messageOverlay {
      z-index: 1000;
    }

    /* ğŸ„ è–èª•æ°›åœæç¤ºæ¡†ï¼šç™½åº•ï¼‹è‰é‚Šï¼‹è§’è½éˆ´éºï¼ˆåŠ å¤§ç‰ˆï¼‰ */
    .message-box {
      position: relative;
      width: 90vw;
      max-width: 520px;
      padding: 38px 26px 34px;
      border-radius: 20px;
      text-align: center;
      background: #ffffff;
      border: 3px solid #e0e0e0;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.75);
      overflow: hidden;
    }

    /* ä¸Šä¸‹ã€Œè‰ã€è£é£¾æ¢ */
    .garland {
      position: absolute;
      left: -10%;
      right: -10%;
      height: 24px;
      background:
        repeating-linear-gradient(
          -45deg,
          #2e7d32 0px,
          #2e7d32 4px,
          #1b5e20 4px,
          #1b5e20 8px
        );
      filter: drop-shadow(0 2px 2px rgba(0,0,0,0.4));
      pointer-events: none;
      z-index: 0;
    }
    .garland-top {
      top: 0;
      border-bottom: 2px solid #145a21;
    }
    .garland-bottom {
      bottom: 0;
      border-top: 2px solid #145a21;
    }

    /* å››è§’éˆ´éºï¼ˆç”¨ emoji å…ˆç•¶ç¤ºæ„ï¼‰ */
    .corner-bell {
      position: absolute;
      font-size: 22px;
      color: #ffd54f;
      text-shadow:
        0 0 2px rgba(0,0,0,0.6),
        0 2px 2px rgba(0,0,0,0.7);
      pointer-events: none;
      z-index: 1;
    }
    .bell-tl { top: 8px; left: 12px; transform: rotate(-15deg); }
    .bell-tr { top: 8px; right: 12px; transform: rotate(12deg); }
    .bell-bl { bottom: 8px; left: 16px; transform: rotate(8deg); }
    .bell-br { bottom: 8px; right: 16px; transform: rotate(-10deg); }

    .message-title {
      position: relative;
      font-size: 38px;
      font-weight: 800;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #b71c1c;
      margin-bottom: 10px;
      z-index: 2;
    }

    .message-title span {
      display: inline-block;
      padding: 4px 14px;
      border-radius: 999px;
      background: rgba(183,28,28,0.08);
    }

    .message-text {
      position: relative;
      font-size: 26px;
      line-height: 1.7;
      color: #333333;
      margin: 12px 4px 24px;
      z-index: 2;
    }

    #callButton {
      position: relative;
      padding: 12px 40px;
      font-size: 19px;
      font-weight: 800;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      background: #ffd54f;
      color: #5a3b00;
      box-shadow: 0 4px 0 #c9a233, 0 0 10px rgba(255, 213, 79, 0.6);
      transition: transform 0.08s ease, box-shadow 0.08s ease;
      z-index: 2;
    }

    #callButton:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #b3952c, 0 0 4px rgba(255, 213, 79, 0.6);
    }

    #callButton::before {
      content: "ğŸ“";
      margin-right: 8px;
    }

    /* å¤±æ•—æç¤ºå°æ¡†ï¼šæ”¾åœ¨ wrapper è£¡ã€åŠåœ“ä¸Šæ–¹ï¼Œæ•´å€‹é»ƒè‰²åœ“è§’æ¡† */
    #failToast {
      position: absolute;
      left: 50%;
      bottom: 34%;
      transform: translateX(-50%) translateY(10px);
      padding: 8px 18px 10px;
      background: #ffd54f;
      border-radius: 999px;
      font-size: 14px;
      letter-spacing: 0.08em;
      color: #5a3b00;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      z-index: 950;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.55);
      transition: transform 0.6s ease-out, opacity 0.6s ease-out;
    }

    /* ğŸ æŠ½ççµæœç•«é¢ï¼ˆé¦´é¹¿å¡ç‰‡ï¼‹æ­å–œä¸­çï¼‰ */
    #resultOverlay {
      z-index: 1100; /* æ¯”è¨Šæ¯æ¡†å†é«˜ä¸€å±¤ */
    }

    .result-card {
      position: relative;
      width: 90vw;
      max-width: 720px;
    }

    .result-image {
      width: 100%;
      display: block;
      border-radius: 24px;
      box-shadow: 0 14px 32px rgba(0,0,0,0.7);
    }

    .result-text {
      position: absolute;
      top: 45%;
      left: 10%;
      right: 10%;
      transform: translateY(-50%);
      text-align: left;
      font-size: 40px;
      font-weight: 900;
      letter-spacing: 0.15em;
      color: #8b4a20;
      text-shadow: 0 3px 4px rgba(255,255,255,0.6);
    }

    @media (max-width: 480px) {
      .result-text {
        font-size: 30px;
        letter-spacing: 0.12em;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- èƒŒæ™¯è–èª•æ‰‹æ©Ÿåœ–ï¼ˆå…¨è¢å¹•ï¼‰ -->
    <img src="BACKGROUND.png" alt="" class="main-image">

    <div id="overlay">
      <canvas id="gameCanvas" width="600" height="300"></canvas>
    </div>

    <!-- å¤±æ•—æç¤ºå°æ¡† -->
    <div id="failToast"></div>
  </div>

  <!-- ä¸­çæ™‚æ’­æ”¾çš„å‹•ç•«å½±ç‰‡ï¼ˆä¿®å¾©è–èª•è¨Šè™Ÿï¼‰ -->
  <div id="winOverlay">
    <video id="winVideo" playsinline webkit-playsinline>
      <source src="DING.MP4" type="video/mp4">
    </video>
  </div>

  <!-- æŠ½çå½±ç‰‡ï¼ˆæŒ‰ CALL å¾Œæ’­æ”¾ï¼‰ -->
  <div id="prizeOverlay">
    <video id="prizeVideo" playsinline webkit-playsinline>
      <source src="DONG.MP4" type="video/mp4">
    </video>
  </div>

  <!-- è–èª•æç¤ºæ¡†ï¼šç™½åº•ï¼‹è‰ï¼‹éˆ´éºï¼ˆåŠ å¤§ç‰ˆï¼‰ -->
  <div id="messageOverlay">
    <div class="message-box">
      <!-- è‰é‚Š -->
      <div class="garland garland-top"></div>
      <div class="garland garland-bottom"></div>

      <!-- éˆ´éºå››è§’ -->
      <div class="corner-bell bell-tl">ğŸ””</div>
      <div class="corner-bell bell-tr">ğŸ””</div>
      <div class="corner-bell bell-bl">ğŸ””</div>
      <div class="corner-bell bell-br">ğŸ””</div>

      <!-- å…§å®¹æ–‡å­— -->
      <div class="message-title">
        <span>XMAS SIGNAL</span>
      </div>
      <div class="message-text">
        å·²æˆåŠŸå¾©åŸè–èª•è¨Šè™Ÿï¼Œæ­£åœ¨èˆ‡åŒ—æ­æœå‹™è™•å–å¾—è¯ç¹«
      </div>
      <button id="callButton">CALL</button>
    </div>
  </div>

  <!-- ğŸ æŠ½ççµæœç•«é¢ï¼šé¦´é¹¿å¡ç‰‡ï¼‹ã€Œæ­å–œä¸­çã€ -->
  <div id="resultOverlay">
    <div class="result-card">
      <img src="result.png" alt="ä¸­ççµæœ" class="result-image">
      <div class="result-text">æ­å–œä¸­ç</div>
    </div>
  </div>

  <script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const winOverlay = document.getElementById("winOverlay");
  const winVideo = document.getElementById("winVideo");
  const prizeOverlay = document.getElementById("prizeOverlay");
  const prizeVideo = document.getElementById("prizeVideo");
  const messageOverlay = document.getElementById("messageOverlay");
  const callButton = document.getElementById("callButton");
  const failToast = document.getElementById("failToast");
  const resultOverlay = document.getElementById("resultOverlay");

  let isWinVideoPlaying = false;
  let isMessageShowing = false;
  let isPrizePlaying = false;
  let isResultShowing = false;
  let failToastTimer = null;

  // å¹¾ä¹ä½”æ»¿å¯¬åº¦çš„åŠåœ“ï¼ˆcanvas é‚„æ˜¯ç”¨ 600x300 çš„åº§æ¨™ç³»ï¼‰
  let cx = canvas.width / 2;
  let cy = canvas.height - 18;
  let outerR = canvas.width * 0.38;
  let innerR = outerR * 0.7;

  const ARC_START = Math.PI;
  const ARC_END   = Math.PI * 2;
  const ARC_LEN   = ARC_END - ARC_START;

  let pointerAngle = ARC_START;
  let pointerDir = 1;
  const pointerSpeed = 3.0;

  let redStart = 0;
  let redEnd = 0;

  let isStopped = false;
  let lastTime = null;

  // å°ˆé–€éš¨æ©Ÿç”¢ç”Ÿç´…è‰²å€åŸŸ
  function randomizeRedZone() {
    const redLen = ARC_LEN * (0.03 + Math.random() * 0.03); // å¾ˆå°çš„å€åŸŸ
    redStart = ARC_START + Math.random() * (ARC_LEN - redLen);
    redEnd = redStart + redLen;
  }

  function resetRound() {
    randomizeRedZone();
    pointerAngle = ARC_START;
    pointerDir = 1;
    isStopped = false;
  }

  function drawArc() {
    // ç™½è‰²åŠåœ“èƒŒæ™¯
    ctx.beginPath();
    ctx.arc(cx, cy, outerR, ARC_START, ARC_END, false);
    ctx.arc(cx, cy, innerR, ARC_END, ARC_START, true);
    ctx.closePath();
    ctx.fillStyle = "#ffffff";
    ctx.fill();

    // ç´…è‰²ä¸­çå€ï¼ˆå°æ‰‡å½¢ï¼‰
    ctx.beginPath();
    ctx.arc(cx, cy, outerR, redStart, redEnd, false);
    ctx.arc(cx, cy, innerR, redEnd, redStart, true);
    ctx.closePath();
    ctx.fillStyle = "#ff4b4b";
    ctx.fill();
  }

  function drawPointer() {
    const midR = (outerR + innerR) / 2;
    const x = cx + midR * Math.cos(pointerAngle);
    const y = cy + midR * Math.sin(pointerAngle);

    ctx.strokeStyle = "#3ecfff";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(x, y);
    ctx.stroke();

    ctx.beginPath();
    ctx.arc(x, y, 8, 0, Math.PI * 2);
    ctx.fillStyle = "#3ecfff";
    ctx.fill();
  }

  function update(dt) {
    if (isStopped) return;

    pointerAngle += pointerDir * pointerSpeed * dt;

    if (pointerAngle > ARC_END) {
      pointerAngle = ARC_END;
      pointerDir = -1;
    } else if (pointerAngle < ARC_START) {
      pointerAngle = ARC_START;
      pointerDir = 1;
    }
  }

  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawArc();
    drawPointer();
  }

  function loop(timestamp) {
    if (lastTime == null) lastTime = timestamp;
    const dt = (timestamp - lastTime) / 1000;
    lastTime = timestamp;
    update(dt);
    render();
    requestAnimationFrame(loop);
  }

  // ===== å¤±æ•—æç¤ºå°æ¡† =====
  function showFailToast() {
    if (!failToast) return;

    const messages = ["è¨Šè™Ÿå‚³é€å¤±æ•—", "å°±å·®ä¸€é»äº†", "åŠ æ²¹ï¼åŠ æ²¹ï¼"];
    const msg = messages[Math.floor(Math.random() * messages.length)];
    failToast.textContent = msg;

    if (failToastTimer) {
      clearTimeout(failToastTimer);
      failToastTimer = null;
    }

    failToast.style.opacity = "0";
    failToast.style.transform = "translateX(-50%) translateY(10px)";
    void failToast.offsetWidth;

    failToast.style.opacity = "1";
    failToast.style.transform = "translateX(-50%) translateY(0)";

    failToastTimer = setTimeout(() => {
      failToast.style.opacity = "0";
      failToast.style.transform = "translateX(-50%) translateY(-20px)";
    }, 1200);
  }

  // ===== æµç¨‹æ§åˆ¶ =====

  function showWinVideo() {
    if (!winOverlay || !winVideo) {
      alert("âœ… æ­å–œï¼åœåœ¨ç´…è‰²ç¯„åœå…§ï¼");
      resetRound();
      return;
    }
    isWinVideoPlaying = true;
    winOverlay.style.display = "flex";
    winVideo.currentTime = 0;

    const p = winVideo.play();
    if (p && p.catch) {
      p.catch(() => {
        winVideo.setAttribute("controls", "controls");
      });
    }
  }

  function endWinVideoToMessage() {
    isWinVideoPlaying = false;
    if (winOverlay && winVideo) {
      winOverlay.style.display = "none";
      winVideo.pause();
    }
    showMessageOverlay();
  }

  function showMessageOverlay() {
    isMessageShowing = true;
    if (messageOverlay) messageOverlay.style.display = "flex";
  }

  function hideMessageOverlay() {
    isMessageShowing = false;
    if (messageOverlay) messageOverlay.style.display = "none";
  }

  function showPrizeVideo() {
    if (!prizeOverlay || !prizeVideo) return;
    isPrizePlaying = true;
    prizeOverlay.style.display = "flex";
    prizeVideo.currentTime = 0;

    const p = prizeVideo.play();
    if (p && p.catch) {
      p.catch(() => {
        prizeVideo.setAttribute("controls", "controls");
      });
    }
  }

  function endPrizeVideoAndReset() {
    isPrizePlaying = false;
    if (prizeOverlay && prizeVideo) {
      prizeOverlay.style.display = "none";
      prizeVideo.pause();
    }
    resetRound();
  }

  // é¡¯ç¤ºæŠ½ççµæœç•«é¢
  function showResultOverlay() {
    isPrizePlaying = false;
    if (prizeOverlay && prizeVideo) {
      prizeOverlay.style.display = "none";
      prizeVideo.pause();
    }
    resetRound();                // å…ˆé‡ç½®ä¸‹ä¸€è¼ª
    isResultShowing = true;
    if (resultOverlay) resultOverlay.style.display = "flex";
  }

  function hideResultOverlay() {
    isResultShowing = false;
    if (resultOverlay) resultOverlay.style.display = "none";
  }

  // å¤±æ•—æŒ‡é‡ä¸åœï¼Œåªæœ‰æˆåŠŸæ‰åœä½
  function handleTap() {
    if (isWinVideoPlaying || isMessageShowing || isPrizePlaying || isResultShowing) return;

    const hit = pointerAngle >= redStart && pointerAngle <= redEnd;

    if (hit) {
      isStopped = true;
      showWinVideo();
    } else {
      showFailToast();
      randomizeRedZone();
    }
  }

  // ===== äº‹ä»¶ç¶å®š =====

  window.addEventListener("click", handleTap);
  window.addEventListener("touchstart", (e) => {
    e.preventDefault();
    handleTap();
  }, { passive: false });

  window.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
      e.preventDefault();
      handleTap();
    }
  });

  // ä¸­çå½±ç‰‡æ’­å®Œ â†’ é€²å…¥è¨Šæ¯æ¡†
  if (winVideo) {
    winVideo.addEventListener("ended", endWinVideoToMessage);
  }

  // æŠ½çå½±ç‰‡ï¼šéŒ¯èª¤ â†’ å›åˆ°éŠæˆ²ï¼›æ’­å®Œ â†’ é¡¯ç¤ºçµæœç•«é¢
  if (prizeVideo) {
    prizeVideo.addEventListener("error", () => {
      alert("æŠ½çå½±ç‰‡è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆåç¨±èˆ‡è·¯å¾‘ï¼ˆä¾‹å¦‚ DONG.MP4ï¼‰ã€‚");
      endPrizeVideoAndReset();
    });

    prizeVideo.addEventListener("ended", showResultOverlay);
  }

  // é»æ“Šçµæœç•«é¢ â†’ é—œé–‰ï¼ŒéŠæˆ²å·²ç¶“é‡ç½®å¥½
  if (resultOverlay) {
    resultOverlay.addEventListener("click", hideResultOverlay);
    resultOverlay.addEventListener("touchstart", (e) => {
      e.preventDefault();
      hideResultOverlay();
    }, { passive: false });
  }

  // CALL æŒ‰éˆ•ï¼šé—œé–‰è¨Šæ¯æ¡† â†’ æ’­æŠ½çå½±ç‰‡
  function onCall(e) {
    if (e) {
      e.preventDefault();
      e.stopPropagation();
    }
    hideMessageOverlay();
    showPrizeVideo();
  }

  if (callButton) {
    callButton.addEventListener("click", onCall);
    callButton.addEventListener("touchstart", onCall, { passive: false });
  }

  resetRound();
  requestAnimationFrame(loop);
  </script>
</body>
</html>
