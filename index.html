<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è–èª•è¨Šè™Ÿå°éŠæˆ²</title>
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      background: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    /* å¤–å±¤ï¼šæ±ºå®šåœ–ç‰‡ï¼‹åŠåœ“çš„å¯¬åº¦ */
    .wrapper {
      position: relative;
      width: 90vw;
      max-width: 600px;
    }

    /* ä¸Šæ–¹è–èª•åœ–ç‰‡ï¼ˆæ›æˆä½ çš„æª”åï¼‰ */
    .main-image {
      width: 100%;
      height: auto;
      display: block;
    }

    /* åŠåœ“æŒ‡é‡ç–Šåœ¨åœ–ç‰‡è£¡ï¼Œé ä¸‹æ–¹å››åˆ†ä¹‹ä¸€ */
    #overlay {
      position: absolute;
      left: 50%;
      bottom: 8%;           /* æƒ³å†å¾€ä¸Šå°±æ”¹å¤§ä¸€é»ï¼Œä¾‹å¦‚ 15% */
      transform: translateX(-50%);
      width: 100%;
      display: flex;
      justify-content: center;
      pointer-events: none;   /* é»æ“Šäº¤çµ¦ window */
    }

    #gameCanvas {
      width: 100%;           /* å¹¾ä¹è·Ÿåœ–ç‰‡åŒå¯¬ */
      max-width: 600px;
      height: auto;
    }

    /* å‹åˆ©å½±ç‰‡çš„å…¨è¢å¹•é®ç½© */
    #winOverlay,
    #prizeOverlay,
    #messageOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;              /* é è¨­éš±è— */
      justify-content: center;
      align-items: center;
      z-index: 900;
    }

    #winOverlay video,
    #prizeOverlay video {
      width: 90vw;
      max-width: 480px;
      border-radius: 16px;
    }

    /* è–èª•æ°›åœæç¤ºæ¡† */
    #messageOverlay {
      z-index: 1000;
    }

    .message-box {
      position: relative;
      width: 80vw;
      max-width: 420px;
      padding: 24px 20px 26px;
      border-radius: 20px;
      text-align: center;
      background: linear-gradient(135deg, #b71c1c, #880e4f);
      border: 2px solid rgba(255, 255, 255, 0.85);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
      overflow: hidden;
    }

    .message-box::before,
    .message-box::after {
      content: "";
      position: absolute;
      border-radius: 50%;
      opacity: 0.35;
      pointer-events: none;
    }

    .message-box::before {
      width: 120px;
      height: 120px;
      background: radial-gradient(circle at center, #ffffff, transparent 60%);
      top: -40px;
      left: -30px;
    }

    .message-box::after {
      width: 160px;
      height: 160px;
      background: radial-gradient(circle at center, #ffd54f, transparent 65%);
      bottom: -60px;
      right: -40px;
    }

    .message-title {
      position: relative;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #fff;
      margin-bottom: 8px;
    }

    .message-title span {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.2);
    }

    .message-text {
      position: relative;
      font-size: 16px;
      line-height: 1.6;
      color: #fffbe6;
      margin: 6px 0 20px;
    }

    #callButton {
      position: relative;
      padding: 10px 36px;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      background: #ffd54f;
      color: #5a3b00;
      box-shadow: 0 4px 0 #c9a233, 0 0 10px rgba(255, 213, 79, 0.6);
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }

    #callButton:active {
      transform: translateY(2px);
      box-shadow: 0 2px 0 #b3952c, 0 0 4px rgba(255, 213, 79, 0.6);
    }

    #callButton::before {
      content: "ğŸ“";
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- æ›æˆä½ çš„è–èª•æ‰‹æ©Ÿåœ–æª”å -->
    <img src="BACKGROUND.png" alt="" class="main-image">

    <div id="overlay">
      <!-- å›ºå®šç¹ªåœ–åº§æ¨™ 600x300ï¼Œè¦–è¦ºä¸Šæœƒè·Ÿè‘—ä¸Šé¢çš„åœ–ç‰‡ç¸®æ”¾ -->
      <canvas id="gameCanvas" width="600" height="300"></canvas>
    </div>
  </div>

  <!-- ä¸­çæ™‚æ’­æ”¾çš„å‹•ç•«å½±ç‰‡ï¼ˆå·²æˆåŠŸå¾©åŸè–èª•è¨Šè™Ÿï¼‰ -->
  <div id="winOverlay">
    <video id="winVideo" playsinline webkit-playsinline>
      <source src="DING.mp4" type="video/mp4">
    </video>
  </div>

  <!-- æŠ½çå½±ç‰‡ Overlayï¼ˆæŒ‰ä¸‹ CALL å¾Œæ’­æ”¾ï¼‰ -->
  <div id="prizeOverlay">
    <video id="prizeVideo" playsinline webkit-playsinline>
      <!-- æŠŠé€™å€‹æª”åæ›æˆä½ å¯¦éš›çš„æŠ½çå½±ç‰‡æª”åï¼Œå¦‚æœæ˜¯ DONG.MP4 å°±ä¸ç”¨æ”¹ -->
      <source src="DONG.MP4" type="video/mp4">
    </video>
  </div>

  <!-- è–èª•æç¤ºæ¡†ï¼ˆå½±ç‰‡çµæŸå¾Œå‡ºç¾ï¼‰ -->
  <div id="messageOverlay">
    <div class="message-box">
      <div class="message-title">
        <span>MERRY XMAS SIGNAL</span>
      </div>
      <div class="message-text">
        å·²æˆåŠŸå¾©åŸè–èª•è¨Šè™Ÿï¼Œæ­£åœ¨èˆ‡åŒ—æ­æœå‹™è™•å–å¾—è¯ç¹«
      </div>
      <button id="callButton">CALL</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const winOverlay = document.getElementById("winOverlay");
    const winVideo = document.getElementById("winVideo");
    const prizeOverlay = document.getElementById("prizeOverlay");
    const prizeVideo = document.getElementById("prizeVideo");
    const messageOverlay = document.getElementById("messageOverlay");
    const callButton = document.getElementById("callButton");

    let isVideoPlaying = false;     // ä¸­çå½±ç‰‡æ’­æ”¾ä¸­
    let isMessageShowing = false;   // è–èª•æç¤ºæ¡†é¡¯ç¤ºä¸­
    let isPrizePlaying = false;     // æŠ½çå½±ç‰‡æ’­æ”¾ä¸­

    // å¹¾ä¹ä½”æ»¿å¯¬åº¦çš„åŠåœ“
    let cx = canvas.width / 2;
    let cy = canvas.height - 18;        // é è¿‘ç•«å¸ƒåº•éƒ¨
    let outerR = canvas.width * 0.38;   // åŠåœ“åŠå¾‘
    let innerR = outerR * 0.7;          // åŠåœ“åšåº¦

    const ARC_START = Math.PI;          // 180Â°ï¼ˆå·¦é‚Šï¼‰
    const ARC_END   = Math.PI * 2;      // 360Â°ï¼ˆå³é‚Šï¼‰
    const ARC_LEN   = ARC_END - ARC_START;

    let pointerAngle = ARC_START;
    let pointerDir = 1;
    const pointerSpeed = 3.0;

    let redStart = 0;
    let redEnd = 0;

    let isStopped = false;
    let lastTime = null;

    function resetRound() {
      // éš¨æ©Ÿä¸€æ®µç´…è‰²ä¸­çå€åŸŸï¼ˆå¾ˆå°ï¼‰
      const redLen = ARC_LEN * (0.03 + Math.random() * 0.03);
      redStart = ARC_START + Math.random() * (ARC_LEN - redLen);
      redEnd = redStart + redLen;

      pointerAngle = ARC_START;
      pointerDir = 1;
      isStopped = false;
    }

    function drawArc() {
      // ç™½è‰²åŠåœ“
      ctx.beginPath();
      ctx.arc(cx, cy, outerR, ARC_START, ARC_END, false);
      ctx.arc(cx, cy, innerR, ARC_END, ARC_START, true);
      ctx.closePath();
      ctx.fillStyle = "#ffffff";
      ctx.fill();

      // ç´…è‰²ä¸­çå€
      ctx.beginPath();
      ctx.arc(cx, cy, outerR, redStart, redEnd, false);
      ctx.arc(cx, cy, innerR, redEnd, redStart, true);
      ctx.closePath();
      ctx.fillStyle = "#ff4b4b";
      ctx.fill();
    }

    function drawPointer() {
      const midR = (outerR + innerR) / 2;
      const x = cx + midR * Math.cos(pointerAngle);
      const y = cy + midR * Math.sin(pointerAngle);

      ctx.strokeStyle = "#3ecfff";
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.lineTo(x, y);
      ctx.stroke();

      ctx.beginPath();
      ctx.arc(x, y, 8, 0, Math.PI * 2);
      ctx.fillStyle = "#3ecfff";
      ctx.fill();
    }

    function update(dt) {
      if (isStopped) return;

      pointerAngle += pointerDir * pointerSpeed * dt;

      if (pointerAngle > ARC_END) {
        pointerAngle = ARC_END;
        pointerDir = -1;
      } else if (pointerAngle < ARC_START) {
        pointerAngle = ARC_START;
        pointerDir = 1;
      }
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawArc();
      drawPointer();
    }

    function loop(timestamp) {
      if (lastTime == null) lastTime = timestamp;
      const dt = (timestamp - lastTime) / 1000;
      lastTime = timestamp;
      update(dt);
      render();
      requestAnimationFrame(loop);
    }

    function showWinVideo() {
      if (!winOverlay || !winVideo) {
        alert("âœ… æ­å–œï¼åœåœ¨ç´…è‰²ç¯„åœå…§ï¼");
        resetRound();
        return;
      }
      isVideoPlaying = true;
      winOverlay.style.display = "flex";
      winVideo.currentTime = 0;

      const p = winVideo.play();
      if (p && p.catch) {
        p.catch(() => {
          winVideo.setAttribute("controls", "controls");
        });
      }
    }

    function onWinVideoEnded() {
      // ä¸­çå½±ç‰‡çµæŸï¼šé—œæ‰å½±ç‰‡ â†’ é¡¯ç¤ºè–èª•æç¤ºæ¡†
      isVideoPlaying = false;
      winOverlay.style.display = "none";
      winVideo.pause();
      showMessageOverlay();
    }

    function showMessageOverlay() {
      isMessageShowing = true;
      messageOverlay.style.display = "flex";
    }

    function hideMessageOverlay() {
      isMessageShowing = false;
      messageOverlay.style.display = "none";
    }

    function showPrizeVideo() {
      if (!prizeOverlay || !prizeVideo) return;
      isPrizePlaying = true;
      prizeOverlay.style.display = "flex";
      prizeVideo.currentTime = 0;

      const p2 = prizeVideo.play();
      if (p2 && p2.catch) {
        p2.catch(() => {
          prizeVideo.setAttribute("controls", "controls");
        });
      }
    }

    function hidePrizeVideoAndReset() {
      isPrizePlaying = false;
      prizeOverlay.style.display = "none";
      prizeVideo.pause();
      resetRound();
    }

    function handleTap() {
      // æ’­æ”¾ä»»ä½•å½±ç‰‡æˆ–é¡¯ç¤ºæç¤ºæ¡†æ™‚ï¼Œä¸è™•ç†éŠæˆ²é»æ“Š
      if (isVideoPlaying || isMessageShowing || isPrizePlaying) return;

      if (!isStopped) {
        isStopped = true;
        const hit = pointerAngle >= redStart && pointerAngle <= redEnd;
        if (hit) {
          // ä¸­ç â†’ æ’­æ”¾ä¸­çå‹•ç•«å½±ç‰‡
          showWinVideo();
        } else {
          alert("âŒ å·®ä¸€é»é»ï¼Œå†è©¦ä¸€æ¬¡ï¼");
        }
      } else {
        // æ²’ä¸­çæƒ…æ³ä¸‹ï¼šç¬¬äºŒæ¬¡é»é‡ç©
        resetRound();
      }
    }

    // å…¨ç•«é¢éƒ½å¯ä»¥é»
    window.addEventListener("click", handleTap);
    window.addEventListener("touchstart", (e) => {
      e.preventDefault();
      handleTap();
    }, { passive: false });

    window.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        e.preventDefault();
        handleTap();
      }
    });

    // å½±ç‰‡äº‹ä»¶ç¶å®š
    if (winVideo) {
      winVideo.addEventListener("ended", onWinVideoEnded);
    }

    if (prizeVideo) {
      prizeVideo.addEventListener("ended", hidePrizeVideoAndReset);
    }

    if (prizeOverlay) {
      // è®“ç©å®¶å¯ä»¥é»ç•«é¢é—œé–‰æŠ½çå½±ç‰‡ä¸¦é‡ä¾†
      prizeOverlay.addEventListener("click", hidePrizeVideoAndReset);
      prizeOverlay.addEventListener("touchstart", (e) => {
        e.preventDefault();
        hidePrizeVideoAndReset();
      }, { passive: false });
    }

    // CALL æŒ‰éˆ• â†’ é—œæç¤ºæ¡†ï¼Œæ’­æŠ½çå½±ç‰‡
    if (callButton) {
      callButton.addEventListener("click", () => {
        hideMessageOverlay();
        showPrizeVideo();
      });
    }

    resetRound();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
