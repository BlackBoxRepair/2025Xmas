<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è–èª•è¨Šè™Ÿå°éŠæˆ²</title>
  <style>
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      background: #000;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* å¤–å±¤å®¹å™¨ï¼šä¸Šé¢æ˜¯åœ–ç‰‡ã€ä¸‹é¢æ˜¯éŠæˆ²æŒ‡é‡ */
    .wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    /* ä¸»åœ–ç‰‡ï¼šæ›æˆä½ çš„è–èª•æ‰‹æ©Ÿåœ– */
    .main-image {
      width: 90vw;
      max-width: 600px;
      height: auto;
      display: block;
    }

    /* åœ–ç‰‡ä¸‹æ–¹çš„éŠæˆ²å€ */
    #overlay {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      pointer-events: none;  /* é»æ“Šäº‹ä»¶äº¤çµ¦ window ä¾†è™•ç† */
    }

    #gameCanvas {
      width: 80vw;
      max-width: 600px;
      height: auto;
    }

    #status {
      margin-top: 8px;
      padding: 4px 10px;
      background: rgba(0,0,0,0.55);
      border-radius: 999px;
      font-size: 14px;
      text-align: center;
      pointer-events: none;
    }

    @media (min-aspect-ratio: 3/4) {
      /* æ©«å‘è¢å¹•æ™‚è®“ç•«å¸ƒå°ä¸€é» */
      #gameCanvas {
        width: 50vw;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- ä¸Šæ–¹ä¸»åœ–ç‰‡ï¼ˆè«‹æ›æˆä½ çš„åœ–ç‰‡æª”åï¼‰ -->
    <img src="BACKGROUND.png" alt="è–èª•æ´»å‹•åœ–ç‰‡" class="main-image">

    <!-- ä¸‹æ–¹æ˜¯éŠæˆ²æŒ‡é‡ -->
    <div id="overlay">
      <canvas id="gameCanvas" width="600" height="260"></canvas>
      <div id="status">ğŸ‘† é»ä¸€ä¸‹è¢å¹•åœæ­¢æŒ‡é‡ï¼Œåœåœ¨ç´…è‰²ç¯„åœå°±ç®—ç²å‹ï¼</div>
    </div>
  </div>

  <script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const statusEl = document.getElementById("status");

  // æŠŠåœ“å¿ƒæ”¾åœ¨ç•«å¸ƒé ä¸‹æ–¹ä¸€é»ï¼ŒåŠåœ“å¾€ã€Œä¸Šé¢ã€é•·å‡ºä¾†
  const cx = canvas.width / 2;
  const cy = canvas.height - 10;   // é è¿‘ç•«å¸ƒåº•éƒ¨
  const outerR = 120;
  const innerR = 80;

  // ç•«ä¸€å€‹ä¸‹ç·£åœ¨åœ“å¿ƒã€å¾€ä¸Šé•·å‡ºçš„åŠåœ“ï¼ˆ180Â° ~ 360Â°ï¼‰
  const ARC_START = Math.PI;        // 180Â°
  const ARC_END   = Math.PI * 2;    // 360Â°
  const ARC_LEN   = ARC_END - ARC_START;

  let pointerAngle = ARC_START;
  let pointerDir = 1;
  const pointerSpeed = 2.0;  // å¯è‡ªè¡Œèª¿æ•´å¿«æ…¢

  let redStart = 0;
  let redEnd = 0;

  let isStopped = false;  // false: è‡ªå‹•å·¦å³æ–æ“º, true: å·²åœæ­¢é¡¯ç¤ºçµæœ
  let lastTime = null;

  function resetRound() {
    // ç´…è‰²ä¸­çå€åŸŸï¼šéš¨æ©Ÿé•·åº¦ + ä½ç½®
    const redLen = ARC_LEN * (0.18 + Math.random() * 0.14);
    redStart = ARC_START + Math.random() * (ARC_LEN - redLen);
    redEnd = redStart + redLen;

    pointerAngle = ARC_START;
    pointerDir = 1;
    isStopped = false;
    statusEl.textContent = "ğŸ‘† é»ä¸€ä¸‹è¢å¹•åœæ­¢æŒ‡é‡ï¼Œåœåœ¨ç´…è‰²ç¯„åœå°±ç®—ç²å‹ï¼";
  }

  function drawArc() {
    // ç™½è‰²åŠåœ“èƒŒæ™¯
    ctx.beginPath();
    ctx.arc(cx, cy, outerR, ARC_START, ARC_END, false);
    ctx.arc(cx, cy, innerR, ARC_END, ARC_START, true);
    ctx.closePath();
    ctx.fillStyle = "#ffffff";
    ctx.fill();

    // ç´…è‰²ä¸­çç¯„åœ
    ctx.beginPath();
    ctx.arc(cx, cy, outerR, redStart, redEnd, false);
    ctx.arc(cx, cy, innerR, redEnd, redStart, true);
    ctx.closePath();
    ctx.fillStyle = "#ff4b4b";
    ctx.fill();
  }

  function drawPointer() {
    const midR = (outerR + innerR) / 2;
    const x = cx + midR * Math.cos(pointerAngle);
    const y = cy + midR * Math.sin(pointerAngle);

    // æŒ‡é‡ç·šï¼šå¾åœ“å¿ƒå°„å‡ºå»
    ctx.strokeStyle = "#3ecfff";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(x, y);
    ctx.stroke();

    // æŒ‡é‡é ­çš„å°åœ“é»
    ctx.beginPath();
    ctx.arc(x, y, 8, 0, Math.PI * 2);
    ctx.fillStyle = "#3ecfff";
    ctx.fill();
  }

  function update(dt) {
    if (isStopped) return;

    pointerAngle += pointerDir * pointerSpeed * dt;

    // ç¢°åˆ°å·¦å³é‚Šç•Œå°±åå½ˆ
    if (pointerAngle > ARC_END) {
      pointerAngle = ARC_END;
      pointerDir = -1;
    } else if (pointerAngle < ARC_START) {
      pointerAngle = ARC_START;
      pointerDir = 1;
    }
  }

  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawArc();
    drawPointer();
  }

  function loop(timestamp) {
    if (lastTime == null) lastTime = timestamp;
    const dt = (timestamp - lastTime) / 1000;
    lastTime = timestamp;
    update(dt);
    render();
    requestAnimationFrame(loop);
  }

  function handleTap() {
    if (!isStopped) {
      // ç¬¬ä¸€æ¬¡é»ï¼šåœæ­¢ä¸¦åˆ¤å®š
      isStopped = true;
      const hit = pointerAngle >= redStart && pointerAngle <= redEnd;
      if (hit) {
        statusEl.textContent = "âœ… æ­å–œï¼ä½ åœ¨ç´…è‰²å€åŸŸå…§åœæ­¢è¨Šè™Ÿï¼å†é»ä¸€æ¬¡è¢å¹•é‡æ–°é–‹å§‹ã€‚";
      } else {
        statusEl.textContent = "âŒ å·®ä¸€é»é»ï¼Œå†è©¦ä¸€æ¬¡ï¼å†é»ä¸€æ¬¡è¢å¹•é‡æ–°é–‹å§‹ã€‚";
      }
    } else {
      // ç¬¬äºŒæ¬¡é»ï¼šé‡æ–°é–‹å±€
      resetRound();
    }
  }

  // å…¨è¢å¹•éƒ½å¯ä»¥é»
  window.addEventListener("click", handleTap);
  window.addEventListener("touchstart", (e) => {
    e.preventDefault();
    handleTap();
  }, { passive: false });

  // å¯é¸ï¼šéµç›¤ç©ºç™½éµä¹Ÿèƒ½ç©
  window.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
      e.preventDefault();
      handleTap();
    }
  });

  resetRound();
  requestAnimationFrame(loop);
</script>
</html>
